/* Copyright (c) 2012 Opera Software ASA
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(k,j){function q(a){return a.replace(/^([+-])?(\d+).?(\d*)[eE]([-+]?\d+)$/,function(a,c,d,g,e){var f=0>+e,h=d.length+ +e,a=(f?d:g).length,e=(e=Math.abs(e))>=a?e-a+f:0,a=Array(e+1).join("0"),d=d+g;return(c||"")+(f?d=a+d:d+=a).substr(0,h+=f?a.length:0)+(h<d.length?"."+d.substr(h):"")})}var n=k.RSVP={},i=k.MutationObserver||k.WebKitMutationObserver;if("undefined"!==typeof process)i=function(a,b){process.nextTick(function(){a.call(b)})};else if(i){var u=[],i=new i(function(){var a=u.slice();
 u=[];a.forEach(function(a){a[0].call(a[1])})}),y=k.document.createElement("div");i.observe(y,{attributes:!0});i=function(a,b){u.push([a,b]);y.setAttribute("drainQueue","drainQueue")}}else i=function(a,b){k.setTimeout(function(){a.call(b)},1)};n.async=i;var E=n.Event=function(a,b){this.type=a;for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])},z=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c][0]===b)return c;return-1},v=function(a){var b=a._promiseCallbacks;b||(b=a._promiseCallbacks={});return b},
 i=n.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,c){var d=v(this),g,c=c||this;(g=d[a])||(g=d[a]=[]);-1===z(g,b)&&g.push([b,c])},off:function(a,b){var c=v(this);if(b){var c=c[a],d=z(c,b);-1!==d&&c.splice(d,1)}else c[a]=[]},trigger:function(a,b){var c,d,g,e;if(c=v(this)[a])for(var f=0,h=c.length;f<h;f++)d=c[f],g=d[0],d=d[1],"object"!==typeof b&&(b={detail:b}),e=new E(a,b),g.call(d,e)}},r=n.Promise=function(a){var b=this;this.binding=a;this.on("promise:resolved",
 function(a){b.trigger("success",{detail:a.detail})},this.binding);this.on("promise:failed",function(a){b.trigger("error",{detail:a.detail})},this.binding)},A=function(){},B=function(a,b,c,d){var g,e;if(c)try{g=c.call(b.binding,d.detail)}catch(f){e=f}else g=d.detail;if(g instanceof r)g.then(function(a){b.resolve(a)},function(a){b.reject(a)});else if(c&&g)b.resolve(g);else if(e)b.reject(e);else b[a](g)};r.prototype={then:function(a,b){var c=new r(this.binding);this.on("promise:resolved",function(b){B("resolve",
 c,a,b)},c.binding);this.on("promise:failed",function(a){B("reject",c,b,a)},c.binding);return c},resolve:function(a){n.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=A},reject:function(a){n.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=this.resolve=A}};i.mixin(r.prototype);var f=function(a,b){this.options=b||{debug:!1};this.svc=a;this.action=function(){};if(!this.svc||!(this.svc instanceof
 NetworkService))return this.debugLog("First argument provided in constructor MUST be a valid NetworkService object"),this;if(!this.svc.type||0!==this.svc.type.indexOf("upnp:"))return this.debugLog("First argument provided in constructor MUST be a _UPnP_ NetworkService object"),this;this.svcType=this.svc.type.replace("upnp:","");this.svcUrl=this.svc.url;var c=this;this.action=function(a,b,e){var f=new RSVP.Promise(this);!e&&"[object Function]"==Object.prototype.toString.call(b)&&(e=b,b={});if(!e||
 "[object Function]"!==Object.prototype.toString.call(e))e=function(){};var h=this.createRequest(this.svcType,a,b);this.sendRequest(this.svcType,a,this.svcUrl,h,function(h,j){null!==h?(e.apply(c,[h,null]),f.reject(h)):c.handleResponse(a,j.responseXML||"",b,function(a,b){e.apply(c,[a,b]);null!==a?f.reject(a):f.resolve(b)})});return f}};f.prototype.constructor=f;f.prototype.requestTemplate='<?xml version="1.0" encoding="utf-8"?>\n<s:Envelope s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">\n\t<s:Body>\n\t\t<u:{ACTION_NAME} xmlns:u="{ACTION_TYPE}">\n{ACTION_VARS}\t\t</u:{ACTION_NAME}>\n\t</s:Body>\n</s:Envelope>\n';
 f.prototype.types={i1:function(a,b){var c=new Int8Array(1);c[0]=a;return f.prototype.checkAllowedValues(c[0],b)},i2:function(a,b){var c=new Int16Array(1);c[0]=a;return f.prototype.checkAllowedValues(c[0],b)},i4:function(a,b){var c=new Int32Array(1);c[0]=a;return f.prototype.checkAllowedValues(c[0],b)},ui1:function(a,b){var c=new Uint8Array(1);c[0]=a;return f.prototype.checkAllowedValues(c[0],b)},ui2:function(a,b){var c=new Uint16Array(1);c[0]=a;return f.prototype.checkAllowedValues(c[0],b)},ui4:function(a,
 b){var c=new Uint32Array(1);c[0]=a;return f.prototype.checkAllowedValues(c[0],b)},"int":function(a,b,c){a===j||null===a||isNaN(a)?a=0:"number"!==typeof a&&(a=!0===a?1:parseInt(a+"",10));c||(a=q(a+""));isNaN(a)&&(a=0);return f.prototype.checkAllowedValues(a,b)},r4:function(a,b,c){var d=new Float32Array(1);d[0]=a;return!c?d[0]?q(d[0]+""):"0":f.prototype.checkAllowedValues(d[0],b)},r8:function(a,b,c){var d=new Float64Array(1);d[0]=a;return!c?d[0]?q(d[0]+""):"0":f.prototype.checkAllowedValues(d[0],b)},
 number:function(a,b,c){return f.prototype.types.r8(a,b,c)},fixed_14_4:function(a,b,c){return f.prototype.types["float"](a,b,c)},"float":function(a,b,c){a=parseFloat(a);return!c?a?q(a+""):"0":f.prototype.checkAllowedValues(a,b)},"char":function(a,b){a=a===j||null===a||""===a||"NaN"==a+""||a instanceof RegExp?"":!1===a||!0===a||"true"==a||"yes"==a||"false"==a||"no"==a?!0===a||"true"==a||"yes"==a?"1":"0":a.toString();return 0<a.length?(a=f.prototype.checkAllowedValues(a,b),a.charAt(0)):a},string:function(a,
 b){if(a===j||null===a||""===a||"NaN"==a+""||a instanceof RegExp)a="";return a=f.prototype.checkAllowedValues(a+"",b)},date:function(a,b,c){return f.prototype.types.dateTime(a,b,c)},dateTime:function(a,b,c){if(c)if("[object String]"==Object.prototype.toString.call(a)){var c=Date,d=a,g=0,e=[1,4,5,6,7,10,11];"string"!==typeof d&&(d+="");if(a=/^((\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:[T\s]?(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{4}))?)?$/.exec(d)){for(var a=a.slice(1,a.length),
 d=0,m;m=e[d];++d)a[m]=+a[m]||0;a[2]=(+a[2]||1)-1;a[3]=+a[3]||1;"Z"!==a[8]&&a[9]!==j&&(g=60*(a[10]/100-a[10]/100%1)+a[10]%100,"+"===a[9]&&(g=0-g));a=Date.UTC(a[1],a[2],a[3],a[4],a[5]+g,a[6],a[7])}else a=Date.parse?Date.parse(d):NaN;a=new c(a);isNaN(a)&&(a="")}else Object.prototype.toString.call(a);else"[object String]"==Object.prototype.toString.call(a)?a+="":"[object Date]"==Object.prototype.toString.call(a)&&(a="Invalid Date"==a.toString()?"":a.toISOString());return a=f.prototype.checkAllowedValues(a,
 b)},dateTime_tz:function(a,b,c){return f.prototype.types.dateTime(a,b,c)},time:function(a,b,c){return f.prototype.types.dateTime(a,b,c)},time_tz:function(a,b,c){return f.prototype.types.dateTime(a,b,c)},"boolean":function(a,b,c){return a="false"==a||"f"==a||"no"==a||"n"==a||a instanceof RegExp||0>=a||!a?c?!1:"0":c?!0:"1"},bin_base64:function(a,b,c){if(a===j||null===a||""===a||"NaN"==a+""||a instanceof RegExp)a="";if(!0===a||!1===a)a=!0===a?"1":"0";a=c?F(a+""):G(a+"");return f.prototype.checkAllowedValues(a,
 b)},bin_hex:function(a,b,c){if(a===j||null===a||""===a||"NaN"==a+""||a instanceof RegExp)a="";if(!0===a||!1===a)a=!0===a?"1":"0";if(c)for(var a=(a+"").toUpperCase().replace(/s\/[^0-9A-Z]\/\/g/),d="",g="",c=0;c<a.length;c++)g+=a.charAt(c),2==g.length&&(g=parseInt(g,16),g=g.toString(16),1==g.length&&(g="0"+g),g="%"+g,g=unescape(g),d+=g,g="");else{a+="";d="";for(c=0;c<a.length;c++){var e,g=a.charCodeAt(c)&255;e="";for(var m=!0,h=32;0<h;){var h=h-4,i=g>>h&15;if(!m||0!=i)m=!1,e+=C[i]}g=e=""==e?"0":e;for(e=
 e.length;2>e;e++)g="0"+g;d+=g}}a=d;return f.prototype.checkAllowedValues(a,b)},uri:function(a,b,c){c&&(a=decodeURI(a+""));return f.prototype.types.string(a,b)},uuid:function(a,b){return f.prototype.types.string(a,b)}};for(var l in f.prototype.types)f.prototype.types[l]._name=l,f.prototype.types[l].toString=function(){return this._name};f.prototype.createRequest=function(a,b,c){c=this.formatParameters(c);this.debugLog("Creating UPnP XML Control Message for ["+b+"] with parameters:");this.debugLog(JSON?
 JSON.stringify(c):null);var d=this.requestTemplate.replace(/\{ACTION_TYPE\}/g,w(s(a))),d=d.replace(/\{ACTION_NAME\}/g,w(s(b))),c=c.request,g="";if(c)for(var e in c){if(c[e].type!==j&&null!==c[e].type){var f=this.types[c[e].type];f&&(c[e].value=f(c[e].value,c[e].allowedValueList,!1))}if(null===c[e].value||c[e].value===j)c[e].value="";g+="\t\t\t<"+e+">"+w(s(c[e].value+""))+"</"+e+">\n"}d=d.replace(/\{ACTION_VARS\}/g,g);this.debugLog("[REQUEST] (SOAPAction: "+a+"#"+b+") "+d);return d};f.prototype.sendRequest=
 function(a,b,c,d,g){try{var e=t.get();e.open("POST",c);e.setRequestHeader("SOAPAction",'"'+a.replace(/[\"\#]/g,"")+"#"+b.replace(/[\"\#]/g,"")+'"');e.setRequestHeader("Content-Type",'text/xml; charset="utf-8";');e.onabort=e.onerror=function(){g.apply(j,[new x("XmlHttpRequest failed"),null]);t.release(e)};var f=this;e.onreadystatechange=function(){4>this.readyState||(200!==this.status?(g.apply(j,[new x("XmlHttpRequest expected 200 OK. Received "+this.status+" response."),null]),f.debugLog("[ERROR-RESPONSE] "+
 this.responseText)):(f.debugLog("[SUCCESS-RESPONSE] "+this.responseText),g.apply(this,[null,this])),t.release(e))};e.send(d)}catch(h){g.apply(j,[new x(h),null])}return this};f.prototype.handleResponse=function(a,b,c,d){var c=this.formatParameters(c),c=c.response,f={},e=b.getElementsByTagName?b.getElementsByTagName(a+"Response"):null;if(null===e||0>=e.length)e=b.getElementsByTagName?b.getElementsByTagName("u:"+a+"Response"):null;if(null!==e&&0<e.length&&(a=e[0].childNodes)&&0<a.length){b=0;for(e=a.length;b<
 e;b++){var i=a[b].nodeName,h=a[b].firstChild?s((a[b].firstChild.nodeValue+"").replace(/\&quot;/g,'"').replace(/\&\#39;/g,"'").replace(/\&gt;/g,">").replace(/\&lt;/g,"<").replace(/\&amp;/g,"&")):null;if(c[i]&&c[i].type!==j&&null!==c[i].type){var k=this.types[c[i].type];k&&(h=k(h,c[i].allowedValueList||null,!0))}f[i]=h!==j&&null!==h?h:""}}d.apply(j,[null,{data:f}]);return this};f.prototype.formatParameter=function(a){var b={};a.type!==j||a.value!==j||a.allowedValueList!==j?(b=a,a.allowedValueList!==
 j&&"array"!==typeof a.allowedValueList&&(a.allowedValueList=[])):b={value:a};b.type!==j&&null!==b.type&&(this.types[b.type+""]||delete b.type);return b};f.prototype.formatParameters=function(a){if(a===j||null===a)a={};a.request||(a.request={});a.response||(a.response={});for(var b in a)if("request"===b||"response"===b)for(var c in a[b])a[b][c]=this.formatParameter(a[b][c]);else a.request[b]=this.formatParameter(a[b]),delete a[b];return a};f.prototype.checkAllowedValues=function(a,b){if(a&&b&&"[object Array]"==
 Object.prototype.toString.call(b)){for(var c=!1,d=0,f=b.length;d<f;d++)if(a==b[d]){c=!0;break}if(!c)return""}return a};f.prototype.debugLog=function(a,b){if(this.options&&this.options.debug)console[b||"log"]("Plug.UPnP: "+a)};var t,D=[];t={get:function(){return D.pop()||new XMLHttpRequest},release:function(a){a.onreadystatechange=function(){};D.push(a)}};var x=function(a){return{description:a}},p={};for(l=0;64>l;l++)p["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l)]=l;
 var H=function(a){var b=[0,2,1][a.length%3],a=a.charCodeAt(0)<<16|(1<a.length?a.charCodeAt(1):0)<<8|(2<a.length?a.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>12&63),2<=b?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6&63),1<=b?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a&63)].join("")},I=function(a){var b=
 a.length,c=b%4,a=(0<b?p[a.charAt(0)]<<18:0)|(1<b?p[a.charAt(1)]<<12:0)|(2<b?p[a.charAt(2)]<<6:0)|(3<b?p[a.charAt(3)]:0),a=[String.fromCharCode(a>>>16),String.fromCharCode(a>>>8&255),String.fromCharCode(a&255)];a.length-=[0,0,2,1][c];return a.join("")},G=k.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,H)},F=k.atob||function(a){return a.replace(/[\s\S]{1,4}/g,I)},C;l={};for(i=0;16>i;i++)l[i]="0123456789abcdef".charAt(i);C=l;var s=function(a){return String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,
 "")},w=function(a){return a.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")};k.Plug||(k.Plug={});k.Plug.UPnP||(k.Plug.UPnP=f)}(this);