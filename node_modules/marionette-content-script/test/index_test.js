suite('index', function() {
  var CLOCK_APP = 'app://clock.gaiamobile.org';
  var assert = require('assert');

  marionette.plugin('apps', require('marionette-apps'));
  marionette.plugin('contentScript', require('../'));

  var client = marionette.client();

  suite('#inject', function() {
    setup(function() {
      client.contentScript.inject(__dirname + '/fixtures/load_everywhere.js');
      client.apps.launch(CLOCK_APP);
      client.apps.switchToApp(CLOCK_APP);
    });

    var expectedValue = 'UNIQUE';
    function getCustomProperty() {
      return client.executeScript(function() {
        return window.wrappedJSObject.navigator.I_AM_HACKED;
      });
    }

    function updatesCustomProperty(message) {
      assert.equal(
        getCustomProperty(),
        expectedValue,
        message
      );
    }

    test('in a single app', function() {
      updatesCustomProperty('I_AM_HACKED is exposed');
    });
  });

});
