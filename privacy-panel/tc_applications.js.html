<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tc/applications.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tc/applications.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Transparency Control -- Application List panel.
 *
 * @module TcApplicationsPanel
 * @return {Object}
 */
define([
  'panels',
  'app_list',
  'tc/app_details'
],

function(panels, appList, appDetails) {
  'use strict';

  var _appPanelContainer;
  var _appListContainer;
  var _appSearchInput;
  var _appItems = [];

  /**
   * TC-Applications panel
   *
   * @constructor
   */
  function TcApplicationsPanel() {}

  TcApplicationsPanel.prototype = {

    /**
     * Initialize the Applications panel and its subpanel
     *
     * @method init
     * @param {Object} permissionTable  List of supported permissions.
     */
    init: function init(permissionTable) {
      _appPanelContainer = document.getElementById('tc-applications');
      _appListContainer = document.getElementById('tc-appList');
      var sortKeySelect = document.getElementById('tc-sortKey');

      var refreshAppList = () => this.renderAppList(sortKeySelect.value);
      sortKeySelect.addEventListener('change', refreshAppList);
      window.addEventListener('applicationinstall', refreshAppList);
      window.addEventListener('applicationuninstall', refreshAppList);

      // some apps might have a localized name in their manifest
      window.addEventListener('localized', refreshAppList);

      this._initSearchBox();

      appList.init(permissionTable).then(() => this.renderAppList(),
          error => console.error(error));

      appDetails.init();
    },

    /**
     * Render the Applications panel.
     *
     * @method renderAppList
     * @param {String} sortKey [optional]  Either 'name', 'trust', 'vendor'.
     */
    renderAppList: function renderAppList(sortKey) {
      this._clear();
      if (!sortKey || sortKey === 'name') {
        // apps are already sorted by name, just display them
        this._showAppList(appList.applications);
      }
      else {
        var apps = appList.getSortedApps(sortKey);
        // sorting by headers work because the sort key is either:
        // - a "vendor" name, in which case it makes sense to sort by name
        // - 'certified|privileged|web', which luckily matches the order we want
        Object.keys(apps).sort().forEach(header => {
          var l10nPrefix = (sortKey === 'trust') ? 'tc-trust-' : '';
          this._showAppSeparator(header, l10nPrefix);
          this._showAppList(apps[header], header);
        });
      }
      _appItems = _appListContainer.querySelectorAll('li');
    },

    _clear: function _clear() {
      _appListContainer.innerHTML = '';
    },

    _showAppSeparator: function _showAppSeparator(separator, l10nPrefix) {
      if (!separator) {
        return;
      }
      var header = document.createElement('header');
      var title = document.createElement('h2');
      if (l10nPrefix) {
        title.setAttribute('data-l10n-id', l10nPrefix + separator);
      } else { // vendor names don't need any localization
        title.textContent = separator;
      }
      header.appendChild(title);
      _appListContainer.appendChild(header);
    },

    _showAppList: function _showAppList(apps, groupKey) {
      var list = document.createElement('ul');
      if (groupKey) {
        list.dataset.key = groupKey; // Marionette key
      }

      apps.forEach(app => {
        var item = document.createElement('li');
        var link = document.createElement('a');
        var icon = document.createElement('img');
        var name = document.createElement('span');

        icon.src = app.iconURL;
        name.textContent = app.name;
        link.classList.add('menu-item');
        link.appendChild(icon);
        link.appendChild(name);
        link.addEventListener('click', () => {
          panels.show({ id: 'tc-appDetails', options: app });
          setTimeout(this._closeSearchBox.bind(this));
        });

        item.classList.add('app-element');
        item.dataset.key = app.name; // Marionette hook
        item.appendChild(link);

        list.appendChild(item);
      });

      _appListContainer.appendChild(list);
    },

    /**
     * Filter the application list when the 'search' mode is on.
     *
     * @method filterAppList
     * @param {String} pattern  Search pattern.
     */
    filterAppList: function filterAppList() {
      var pattern = _appSearchInput.value.replace(/^\s+|\s+$/g, '');
      var re = pattern &amp;&amp; pattern.length ? new RegExp(pattern, 'i') : null;
      for (var i = 0, l = _appItems.length; i &lt; l; i++) {
        _appItems[i].hidden = re &amp;&amp; !re.test(_appItems[i].dataset.key);
      }
    },

    _initSearchBox: function _initSearchBox() {
      var appSearch = document.getElementById('tc-appSearch');
      _appSearchInput = appSearch.querySelector('input');
      _appSearchInput.oninput = () => this.filterAppList();
      _appSearchInput.onfocus = () => this._searchMode = true;

      // The `Clear` button does now work out of the box because it's a
      // &lt;button type="reset"> -- not an &lt;input type="reset">.
      var appSearchClear = appSearch.querySelector('button[type="reset"]');
      appSearchClear.addEventListener('touchend', event => {
        event.preventDefault();
        this.renderAppList();
        _appSearchInput.value = '';
      });

      // The `Close` button has a `submit` type (see building blocks)...
      var appSearchCancel = appSearch.querySelector('button[type="submit"]');
      appSearchCancel.addEventListener('touchend', event => {
        event.preventDefault();
        this._closeSearchBox();
      });

      // Now let's prevent the panel to close when the `search` key is pressed:
      appSearch.addEventListener('submit', event => {
        event.preventDefault();
        _appSearchInput.focus();
        return false;
      });
    },

    _closeSearchBox: function _closeSearchBox() {
      _appSearchInput.value = '';
      _appSearchInput.blur();
      this._searchMode = false;
      this.filterAppList();
      return false;
    },

    set _searchMode(value) {
      if (value) {
        _appPanelContainer.classList.add('search');
      } else {
        _appPanelContainer.classList.remove('search');
      }
    }

  };

  return new TcApplicationsPanel();
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-About.html">About</a></li><li><a href="module-ALADefineCustomLocation.html">ALADefineCustomLocation</a></li><li><a href="module-ALAException.html">ALAException</a></li><li><a href="module-AlaPanel.html">AlaPanel</a></li><li><a href="module-AppList.html">AppList</a></li><li><a href="module-BlurSlider.html">BlurSlider</a></li><li><a href="module-Commands.html">Commands</a></li><li><a href="module-ExceptionsPanel.html">ExceptionsPanel</a></li><li><a href="module-PanelController.html">PanelController</a></li><li><a href="module-PassCodePanel.html">PassCodePanel</a></li><li><a href="module-PassPhrase.html">PassPhrase</a></li><li><a href="module-RootPanel.html">RootPanel</a></li><li><a href="module-RPExecuteCommands.html">RPExecuteCommands</a></li><li><a href="module-RpPanel.html">RpPanel</a></li><li><a href="module-ScreenLockPanel.html">ScreenLockPanel</a></li><li><a href="module-TcAppDetailsPanel.html">TcAppDetailsPanel</a></li><li><a href="module-TcApplicationsPanel.html">TcApplicationsPanel</a></li><li><a href="module-TcPanel.html">TcPanel</a></li><li><a href="module-TcPermDetailsPanel.html">TcPermDetailsPanel</a></li><li><a href="module-TcPermissionsPanel.html">TcPermissionsPanel</a></li></ul><h3>Classes</h3><ul><li><a href="module-ALADefineCustomLocation-init.html">init</a></li><li><a href="module-ALAException-init.html">init</a></li><li><a href="module-ExceptionsPanel-init.html">init</a></li><li><a href="module-RootPanel-init.html">init</a></li><li><a href="module-RpPanel-init.html">init</a></li></ul><h3>Global</h3><ul><li><a href="global.html#requirejs">requirejs</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.1</a> on Thu Jul 23 2015 17:05:21 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
